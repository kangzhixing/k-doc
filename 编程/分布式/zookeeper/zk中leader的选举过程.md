## zk中leader的选举过程
### 有两种情况会发起Leader选举：

1. 服务器启动的时候
1. 服务器运行的时候当Leader宕机
在讲解流程之前，先说明一下选举流程中涉及到的角色：

LOOKING：寻找Leader状态，处于该状态需要进入选举流程（只有该节点才可以投票）
LEADING：领导者状态，处于该状态的节点说明是角色已经是Leader
FOLLOWING：跟随者状态，表示Leader已经选举出来，当前节点角色是follower
OBSERVER：观察者状态，表明当前节点角色是observer（该节点不参与竞选）

### 三个核心选举原则：

1. Zookeeper集群中只有超过半数以上的服务器启动，集群才能正常工作；
1. 在集群正常工作之前，myid小的服务器给myid大的服务器投票，直到集群正常工作，选出Leader；
1. 选出Leader之后，之前的服务器状态由Looking改变为Following，以后的服务器都是Follower。

#### 例：
1. **服务器1启动，发起一次选举**
服务器1投自己一票。此时服务器1票数一票，不够半数以上（3票），选举无法完成；
服务器1状态保持为LOOKING；
1. **服务器2启动，再发起一次选举** 
服务器1和2分别投自己一票，此时服务器1发现服务器2的id比自己大，更改选票投给服务器2；
此时服务器1票数0票，服务器2票数2票，不够半数以上（3票），选举无法完成；
服务器1，2状态保持LOOKING；
1. **服务器3启动，发起一次选举** 
与上面过程一样，服务器1和2先投自己一票，然后因为服务器3id最大，两者更改选票投给为服务器3；
此次投票结果：服务器1为0票，服务器2为0票，服务器3为3票。此时服务器3的票数已经超过半数（3票），服务器3当选Leader。
服务器1，2更改状态为FOLLOWING，服务器3更改状态为LEADING；
1. **服务器4启动，发起一次选举** 
此时服务器1，2，3已经不是LOOKING状态，不会更改选票信息。交换选票信息结果：服务器3为3票，服务器4为1票。
此时服务器4服从多数，更改选票信息为服务器3；服务器4并更改状态为FOLLOWING；
1. **服务器5启动，同4一样投票给3，此时服务器3一共5票，服务器5为0票** 
服务器5并更改状态为FOLLOWING；
1. **选举结果** 
最终Leader是服务器3，状态为LEADING；  
其余服务器是Follower，状态为FOLLOWING。